*** Settings ***
Library           ../../../../../Python27/Lib/site-packages/robot/libraries/Collections.py
Library           ../MyPython/ming/Mobile.py
Resource          abstract.txt
Resource          desire_z.txt
Resource          nexus_5.txt
Library           Selenium2Library
Library           ../MyPython/ming/Custom_Library.py
Library           ../../../../../../Python27/Lib/site-packages/robot/libraries/String.py

*** Variables ***
${infinite}       10000

*** Test Cases ***
test
    Set Serial    HT12ERT00129
    Open Notification

test_time
    Click On    text=0
    Click On    text=1

test_watcher
    ${watcher_list}    List All Watchers
    Register Click Watcher    test_watcher    text=Apps    resourceId=com.android.deskclock:id/analog_appwidget
    Register Click Watcher    test_watcher_1    text=Apps    resourceId=com.android.deskclock:id/analog_appwidget
    Register Click Watcher    test_watcher_2    text=Apps    resourceId=com.android.deskclock:id/analog_appwidget
    ${watcher_list}    List All Watchers
    Remove Watchers    test_watcher
    ${watcher_list}    List All Watchers
    Remove Watchers
    ${watcher_list}    List All Watchers
    Log    OK
    Mobile.Sleep    30000

test_screenshot
    screenshot

test_change_ssid
    Turn Off AP
    Turn On AP

switch_camera_lens_position
    ${linearLayout}    Get Object    className=android.widget.LinearLayout    index=2
    ${info_dict}    get_info_of_object    ${linearLayout}
    ${chileCount}    Get From Dictionary    ${info_dict}    chileCount
    ${chileCount}    Evaluate    int(${chileCount})-1
    ${btn}    call    ${linearLayout}    child    instance=${chileCount}    className=android.widget.ImageView
    call    ${btn}    click

launch_google_play_without_user_keyword
    Mobile.Press Home
    ${view}    Mobile.Get Object    className=android.view.View    index=4
    ${all_apps_button}    Mobile.Call    ${view}    child    className=android.widget.TextView    index=2
    Mobile.Call    ${all_apps_button}    click
    Mobile.Click On    description=Shop
    ${play_store_text}    Mobile.Get Object    text=Play Store
    ${is_play_store_text_exist}    Mobile.Wait For Exists    ${play_store_text}    5000
    Should Be True    ${is_play_store_text_exist}    Play Store Text does not exist.

launch_google_play_with_user_keyword
    Mobile.Press Home
    Enter All Apps
    enter_google_play_store
    verify_google_play_text

resource_test
    Import Resource    ${CURDIR}${/}nexus_5.txt
    ${resource_name}    Set Variable    nexus_5
    log    ${resource_name}.enter_app
    desire_z.enter_app    b
    等

test_type
    type    中文你好

test_ssid
    Change Ssid    IAT

dropbox_test
    Install Dropbox
    Set Serial    0489902425228ab9
    Remove Dropbox Account
    Sign In Dropbox    t7820315@ntut.org.tw    ming060
    #
    ${file_name}    Take A Photo
    ${file_name_on_dropbox}    Convert File Name To Dropbox Format    ${file_name}
    Uninstall Dropbox

web_test
    ${dropbox_account}    Set Variable    t7820315@ntut.org.tw
    ${dropbox_pwd}    Set Variable    ming060
    Login Dropbox Wed    ${dropbox_account}    ${dropbox_pwd}
    Verify Photo On Dropbox    2009-02-06 21.27.14.jpg
    Comment    2014-05-17 17.05.41.jpg

Google Play Test
    Install App
    Change Ssid    WIFI_IS_OFF
    Verify Install Success
    [Teardown]    Change Ssid    IAT

test_scroll_to_beginning
    ${list_view}    Get Object    className=android.widget.ListView
    Scroll To Beginning Vertically    ${list_view}

Dropbox Integration Test
    [Setup]    Run Keywords    Set Serial    0489902425228ab9    AND    Clear Recent Apps    AND
    ...    Install Dropbox    AND    Remove Dropbox Account
    ${dropbox_account}    Set Variable    t7820315@ntut.org.tw
    ${dropbox_pwd}    Set Variable    ming060
    Sign In Dropbox    ${dropbox_account}    ${dropbox_pwd}
    #
    ${file_name}    Take A Photo
    ${file_name_on_dropbox}    Convert File Name To Dropbox Format    ${file_name}
    #
    Login Dropbox Wed    ${dropbox_account}    ${dropbox_pwd}
    Verify Photo On Dropbox    ${file_name_on_dropbox}
    [Teardown]    Run Keywords    Clear Recent Apps    AND    Remove Dropbox Account    AND    Uninstall Dropbox

*** Keywords ***
z_open_screen_lock
    Mobile.Swipe    240    560    450    560

Enter All Apps
    ${view}    Mobile.Get Object    className=android.view.View    index=4
    ${all_apps_button}    Mobile.Call    ${view}    child    className=android.widget.TextView    index=2
    Mobile.Call    ${all_apps_button}    click

enter_google_play_store
    Mobile.Click On    description=Shop

verify_google_play_text
    ${play_store_text}    Mobile.Get Object    text=Play Store
    ${is_play_store_text_exist}    Mobile.Wait For Exists    ${play_store_text}    5000
    Should Be True    ${is_play_store_text_exist}    Play Store Text does not exist.
    [Return]    ${is_play_store_text_exist}

Enter App
    [Arguments]    ${app}
    Press Home
    ${info_list}    Get Info
    ${current_package}    Get From Dictionary    ${info_list}    currentPackageName
    Should Be Equal As Strings    com.android.launcher3    ${current_package}
    Click On    text=Apps
    ${page_indactor}    Get Object    resourceId=com.android.launcher3:id/page_indicator
    ${page_indactor_info}    Get Info Of Object    ${page_indactor}
    Log Dictionary    ${page_indactor_info}
    ${page_count}    Get From Dictionary    ${page_indactor_info}    chileCount
    : FOR    ${index}    IN RANGE    ${page_count}
    \    ${app_obj}    Get Object    text=${app}
    \    ${is_app_exist}    Wait For Object Exists    ${app_obj}
    \    Run Keyword If    ${is_app_exist}    Run Keywords    Call    ${app_obj}    click
    \    ...    AND    Exit For Loop    ELSE    Swipe Left    resourceId=com.android.launcher3:id/apps_customize_pane_content

Enter Game Category
    Wait For Exists    5000    text=GAMES
    Click On    text=GAMES

Enter Top Free
    Wait For Exists    5000    text=TOP FREE
    Click On    text=TOP FREE

Click First Item
    Wait For Exists    5000    resourceId=com.android.vending:id/bucket_items
    Click On    resourceId=com.android.vending:id/bucket_items

Click Install
    Wait For Exists    5000    resourceId=com.android.vending:id/buy_button
    Click On    resourceId=com.android.vending:id/buy_button

Register Dialog Watcher
    register_click_watcher    test_watcher    text=Proceed    text=Downloading a large app

Click Accept Button
    Wait For Exists    5000    text=ACCEPT
    Click On    text=ACCEPT

Verify Install Success
    ${install_complete}    Wait For Exists    500000    text=OPEN
    Should Be True    ${install_complete}    Install Fail

Click Connect Button
    ${connect_button}    Get Object    text=Connect
    ${connect_button_info}    Get Info Of Object    ${connect_button}
    ${enabled_info}    Get From Dictionary    ${connect_button_info}    enabled
    Should Be True    ${enabled_info}    Connect button is not enabled
    Click On    text=Connect

Turn On Wifi
    ${switch}    Get Object    className=android.widget.Switch
    ${switch_info}    Get Info Of Object    ${switch}
    ${is_checked}    Get From Dictionary    ${switch_info}    checked
    Run Keyword Unless    ${is_checked}    Click On    className=android.widget.Switch
    ${switch_info}    Get Info Of Object    ${switch}
    ${is_checked}    Get From Dictionary    ${switch_info}    checked
    Should Be True    ${is_checked}    The Wifi should be On

Turn Off AP
    Change Ssid    WIFI_IS_OFF

Turn On AP
    Change Ssid    IAT_OFF

Install App
    Wakeup The Device
    Clear Recent Apps
    Enter App    Play Store
    Enter Game Category
    Enter Top Free
    Click First Item
    Click Install
    Register Dialog Watcher
    Click Accept Button

Disconnect All
    : FOR    ${i}    IN RANGE    ${infinite}
    \    ${is_connected_exist}    Wait For Exists    5000    text=Connected
    \    Run Keyword If    ${is_connected_exist}    Run Keywords    Click On    text=Connected    AND
    \    ...    Click On    text=Forget    ELSE    Exit For Loop

Connect To
    [Arguments]    ${access_point_name}
    ${list_view}    Get Object    className=android.widget.ListView
    Scroll To Vertically    ${list_view}    text=${access_point_name}
    Click On    text=${access_point_name}
    ${is_correct_access_point}    Wait For Exists    text=${access_point_name}
    Should Be True    ${is_correct_access_point}    Click on wrong access point
    ${is_pwd_exist}    Wait For Exists    text=Password
    Run Keyword If    ${is_pwd_exist}    Run Keywords    Set Text    smart@inhon    resourceId=com.android.settings:id/password    AND
    ...    Press Back    AND    Click Connect Button

Remove Dropbox Account
    Enter App    Settings
    ${list_view}    Get Object    className=android.widget.ListView
    ${return}    Scroll To Vertically    ${list_view}    text=Dropbox
    Run Keyword If    ${return}    Remove Dropbox Account From Setting

Remove Dropbox Account From Setting
    Click On    text=Dropbox
    Click On    description=More options
    Click On    text=Remove account
    Click On    text=Remove account
    ${is_dropbox_account_exist}    Wait For Exists    3000    text=Dropbox
    Should Not Be True    ${is_dropbox_account_exist}

Sign In Dropbox
    [Arguments]    ${account}    ${pwd}
    Enter App    Dropbox
    Click On    text=Sign in!
    Set Text    ${pwd}    resourceId=com.dropbox.android:id/login_password
    Set Text    ${account}    resourceId=com.dropbox.android:id/login_email
    Click On    text=Sign in
    Click On    text=Turn on Camera Upload

Take A Photo
    Enter App    Camera
    Click On    description=Shutter
    Swipe Left
    Click On    description=More options
    Click On    text=Details
    Scroll To End Vertically
    ${path_text_view}    Get Object    textStartsWith=Path
    ${text_of_path_text_view}    Get Info Of Object    ${path_text_view}    text
    ${image_file_name}    Fetch From Right    ${text_of_path_text_view}    IMG_
    [Return]    ${image_file_name}

Convert File Name To Dropbox Format
    [Arguments]    ${ifile_name}
    ${file_name_year}    Get Substring    ${ifile_name}    \    4
    ${file_name_month}    Get Substring    ${ifile_name}    4    6
    ${file_name_day}    Get Substring    ${ifile_name}    6    8
    ${file_name_hour}    Get Substring    ${ifile_name}    9    11
    ${file_name_minute}    Get Substring    ${ifile_name}    11    13
    ${file_name_on_second}    Get Substring    ${ifile_name}    13    15
    ${file_name_on_dropbox}    Set Variable    ${file_name_year}-${file_name_month}-${file_name_day} ${file_name_hour}.${file_name_minute}.${file_name_on_second}.jpg
    [Return]    ${file_name_on_dropbox}

Install Dropbox
    Install    C:${/}Users${/}YuMing${/}Documents${/}GitHub${/}furry-ironman${/}RF_uiautomator${/}com.dropbox.android_2.4.0.2.apk

Uninstall Dropbox
    Uninstall    com.dropbox.android

Clear Recent Apps
    Press Recent
    ${is_clear_exist}    Wait For Exists    2000    resourceId=com.android.systemui:id/recents_clear
    Run Keyword If    ${is_clear_exist}    Click On    resourceId=com.android.systemui:id/recents_clear    ELSE    Press Recent

Login Dropbox Wed
    [Arguments]    ${dropbox_account}    ${dropbox_pwd}
    Comment    Set Selenium Speed    1s
    Open Browser    https://www.dropbox.com/    firefox
    Click Link    /login
    Input Text    id=login_email    ${dropbox_account}
    Input Password    id=login_password    ${dropbox_pwd}
    Click Button    id=login_submit

Verify Photo On Dropbox
    [Arguments]    ${photo_name}
    Wait Until Page Contains Element    //a[text()="Camera Uploads"]    5s
    Comment    ${list_items}    Get List Items    id=browse-files
    ${list_items}    Get Value    //a[text()="Camera Uploads"]
    Click Element    //a[text()="Camera Uploads"]
    Comment    ${lsit}    Get List Items    class=mouse-active
    Comment    Log List    ${lsit}
    Comment    Log    ${photo_name}
    Comment    ${all_links}    Get All Links
    Comment    Log List    ${all_links}
    Execute Javascript    for (int second = 0;; second++) {
    ${is_text_exist}    if(second >=60){    ${photo_name}
    Comment    break;    //a[text()="${photo_name}"]    10s
    Comment    }    //a[text()="${photo_name}"]    The photo does not exist.
    \    selenium.getEval("window.scrollBy(0,200)");
    \    Thread.sleep(3000);
    \    }
